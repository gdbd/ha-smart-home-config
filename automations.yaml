- id: '1674550123477'
  alias: Гостиная дубль ЛК
  description: ''
  trigger:
  - platform: device
    domain: mqtt
    device_id: cb5a1302a8884dae4b0c8fd478834990
    type: action
    subtype: single_left
    discovery_id: 0x54ef4410004ff618 action_single_left
  condition: []
  action:
  - type: toggle
    device_id: 97e0615b18f94d252b3d76007d46c665
    entity_id: switch.gostinaia_2_klavishi_left
    domain: switch
  mode: single
- id: '1674550174575'
  alias: Гостиная дубль ПК
  description: ''
  trigger:
  - platform: device
    domain: mqtt
    device_id: cb5a1302a8884dae4b0c8fd478834990
    type: action
    subtype: single_right
    discovery_id: 0x54ef4410004ff618 action_single_right
  condition: []
  action:
  - type: toggle
    device_id: 97e0615b18f94d252b3d76007d46c665
    entity_id: switch.gostinaia_2_klavishi_right
    domain: switch
  mode: single
- id: '1679554303278'
  alias: Ванная пол включить по времени
  description: ''
  trigger:
  - platform: time
    at: '12:00:00'
  condition:
  - condition: device
    type: is_off
    device_id: b903e279854d467307f8cd96d91ccd96
    entity_id: switch.vannaia_pol
    domain: switch
  action:
  - type: turn_on
    device_id: b903e279854d467307f8cd96d91ccd96
    entity_id: switch.vannaia_pol
    domain: switch
  - service: notify.ha_notificator_denis
    data:
      message: пол включён!
  mode: single
- id: '1679554413428'
  alias: Ванная пол выключить по времени
  description: ''
  trigger:
  - platform: time
    at: '23:00:00'
  condition:
  - condition: device
    type: is_on
    device_id: b903e279854d467307f8cd96d91ccd96
    entity_id: switch.vannaia_pol
    domain: switch
  action:
  - type: turn_off
    device_id: b903e279854d467307f8cd96d91ccd96
    entity_id: switch.vannaia_pol
    domain: switch
  - service: notify.ha_notificator_denis
    data:
      message: пол выключён!
  mode: single
- id: '1679856785613'
  alias: Кухня подсветка движение
  description: ''
  trigger:
  - type: motion
    platform: device
    device_id: 384bc5de06080550d181e3a1f14001c4
    entity_id: binary_sensor.kukhnia_dvizhenie_occupancy
    domain: binary_sensor
  condition:
  - condition: time
    after: 07:00:00
    before: 01:00:00
  - condition: device
    type: is_off
    device_id: cea131d0cc56c10c9c8aec6c27c41830
    entity_id: switch.0x54ef44100050f803
    domain: switch
  - condition: device
    type: is_illuminance
    device_id: 384bc5de06080550d181e3a1f14001c4
    entity_id: sensor.kukhnia_dvizhenie_illuminance_lux
    domain: sensor
    below: 50
  - condition: state
    entity_id: timer.kukhnia_taimer_vykliuchatelia_podsvetki
    state: idle
    alias: Прошло время с ручного выключения
  action:
  - type: turn_on
    device_id: cea131d0cc56c10c9c8aec6c27c41830
    entity_id: switch.0x54ef44100050f803
    domain: switch
  - service: timer.start
    data: {}
    target:
      entity_id: timer.kitchen_backlight_timer
  mode: single
- id: Timerstop
  alias: Кухня подсветка таймаут
  description: ''
  trigger:
  - platform: event
    event_type: timer.finished
    event_data:
      entity_id: timer.kitchen_backlight_timer
  condition:
  - condition: device
    type: is_on
    device_id: cea131d0cc56c10c9c8aec6c27c41830
    entity_id: switch.0x54ef44100050f803
    domain: switch
  action:
  - type: turn_off
    device_id: cea131d0cc56c10c9c8aec6c27c41830
    entity_id: switch.0x54ef44100050f803
    domain: switch
  - service: input_boolean.turn_on
    data: {}
    target:
      entity_id: input_boolean.kitchen_backlight_off_by_timeout
- id: '1680204696523'
  alias: Кухня дубль пк
  description: ''
  trigger:
  - platform: device
    domain: mqtt
    device_id: a48c1827e91945626ab06a23851ff1a3
    type: action
    subtype: single
    discovery_id: 0x54ef441000503053 action_single
  condition: []
  action:
  - type: toggle
    device_id: ec3fd6bdfe8c439ad6599a7a82935eaa
    entity_id: switch.kukhnia_2_klavishi_right
    domain: switch
  mode: single
- id: '1680204912844'
  alias: Кухня дубль лк
  description: ''
  trigger:
  - platform: device
    domain: mqtt
    device_id: a48c1827e91945626ab06a23851ff1a3
    type: action
    subtype: double
    discovery_id: 0x54ef441000503053 action_double
  condition: []
  action:
  - type: toggle
    device_id: ec3fd6bdfe8c439ad6599a7a82935eaa
    entity_id: switch.kukhnia_2_klavishi_left
    domain: switch
  mode: single
- id: '1680238465280'
  alias: Кухня подсветка выключено
  description: ''
  trigger:
  - platform: device
    type: turned_off
    device_id: cea131d0cc56c10c9c8aec6c27c41830
    entity_id: switch.0x54ef44100050f803
    domain: switch
  condition: []
  action:
  - service: timer.cancel
    data: {}
    target:
      entity_id: timer.kitchen_backlight_timer
  - if:
    - condition: state
      entity_id: input_boolean.kitchen_backlight_off_by_timeout
      state: 'off'
    then:
    - service: timer.start
      data: {}
      target:
        entity_id: timer.kukhnia_taimer_vykliuchatelia_podsvetki
  mode: single
- id: '1683277064936'
  alias: Кухня подсветка включено
  description: ''
  trigger:
  - platform: device
    type: turned_on
    device_id: cea131d0cc56c10c9c8aec6c27c41830
    entity_id: switch.0x54ef44100050f803
    domain: switch
  condition: []
  action:
  - service: timer.start
    data: {}
    target:
      entity_id: timer.kitchen_backlight_timer
  - service: timer.cancel
    data: {}
    target:
      entity_id: timer.kukhnia_taimer_vykliuchatelia_podsvetki
  - service: input_boolean.turn_off
    data: {}
    target:
      entity_id: input_boolean.kitchen_backlight_off_by_timeout
  mode: single
- id: '1683726354357'
  alias: Туалет вытяжка включено
  description: ''
  trigger:
  - platform: device
    type: turned_on
    device_id: 5a586d070a6c7fcfbbde188b8967625c
    entity_id: switch.tualet_vytiazhka
    domain: switch
  condition: []
  action:
  - service: timer.start
    data: {}
    target:
      entity_id: timer.taimer_tualet_vytiazhka
  mode: single
- id: '1683726563444'
  alias: Туалет вытяжка выключено
  description: ''
  trigger:
  - platform: device
    type: turned_off
    device_id: 5a586d070a6c7fcfbbde188b8967625c
    entity_id: switch.tualet_vytiazhka
    domain: switch
  condition: []
  action:
  - service: timer.cancel
    data: {}
    target:
      entity_id: timer.taimer_tualet_vytiazhka
  mode: single
- id: '1683726759847'
  alias: Туалет вытяжка таймаут
  description: ''
  trigger:
  - platform: event
    event_type: timer.finished
    event_data:
      entity_id: timer.taimer_tualet_vytiazhka
  condition: []
  action:
  - type: turn_off
    device_id: 5a586d070a6c7fcfbbde188b8967625c
    entity_id: switch.tualet_vytiazhka
    domain: switch
  mode: single
- id: '1683748125556'
  alias: Туалет свет включен
  description: ''
  trigger:
  - platform: device
    type: turned_on
    device_id: de7a71b8fd0f7085ab6f8df702d7a4f0
    entity_id: light.tualet_svet
    domain: light
  condition:
  - condition: template
    value_template: "{{\n((now()|as_timestamp|round)\n- \n(states('input_datetime.toilet_last_off_time')|as_datetime|as_local|as_timestamp|round))
      > 5\n}}\n"
    enabled: true
  action:
  - service: timer.start
    data: {}
    target:
      entity_id: timer.taimer_tualet_svet
  - service: input_boolean.turn_off
    data: {}
    target:
      entity_id: input_boolean.toilet_fan_no_start
  mode: single
- id: '1683748277532'
  alias: 'Туалет свет выключен: включить вытяжку'
  description: ''
  trigger:
  - platform: state
    entity_id:
    - light.tualet_svet
    from: 'on'
    to: 'off'
  condition:
  - condition: state
    entity_id: timer.taimer_tualet_svet
    state: idle
    enabled: true
  - condition: state
    entity_id: input_boolean.toilet_fan_no_start
    state: 'off'
  action:
  - service: timer.start
    data: {}
    target:
      entity_id: timer.taimer_tualet_vytiazhka
  - type: turn_on
    device_id: 5a586d070a6c7fcfbbde188b8967625c
    entity_id: switch.tualet_vytiazhka
    domain: switch
  mode: single
- id: '1684180518667'
  alias: Кухня подсветка продление
  description: ''
  trigger:
  - type: motion
    platform: device
    device_id: 384bc5de06080550d181e3a1f14001c4
    entity_id: binary_sensor.kukhnia_dvizhenie_occupancy
    domain: binary_sensor
  condition:
  - condition: device
    type: is_on
    device_id: cea131d0cc56c10c9c8aec6c27c41830
    entity_id: switch.0x54ef44100050f803
    domain: switch
    alias: Включено
  action:
  - if:
    - condition: not
      conditions:
      - condition: state
        entity_id: timer.kitchen_backlight_timer
        state: paused
      alias: not paused
    then:
    - service: timer.start
      data: {}
      target:
        entity_id: timer.kitchen_backlight_timer
  mode: single
- id: '1685215994085'
  alias: 'Туалет дверь открыта: включить свет'
  description: ''
  trigger:
  - type: opened
    platform: device
    device_id: fe4aea95bdeb8772c679f823a4e54144
    entity_id: binary_sensor.tualet_dver_contact
    domain: binary_sensor
    enabled: false
  - platform: state
    entity_id:
    - binary_sensor.tualet_dver_contact
    from: 'off'
    to: 'on'
  condition:
  - condition: device
    type: is_off
    device_id: de7a71b8fd0f7085ab6f8df702d7a4f0
    entity_id: light.tualet_svet
    domain: light
  action:
  - type: turn_on
    device_id: de7a71b8fd0f7085ab6f8df702d7a4f0
    entity_id: light.tualet_svet
    domain: light
  mode: single
- id: '1685216059545'
  alias: 'Ванная дверь: открыто - включить свет'
  description: ''
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.vannaia_dver_contact
    from: 'off'
    to: 'on'
  condition:
  - condition: device
    type: is_off
    device_id: 1caa9e19608f785cb00d0e179a7037b6
    entity_id: light.vannaia_svet
    domain: light
    enabled: false
  action:
  - type: turn_on
    device_id: 1caa9e19608f785cb00d0e179a7037b6
    entity_id: light.vannaia_svet
    domain: light
  - if:
    - condition: state
      entity_id: timer.bath_light_door
      state: paused
    then:
    - service: timer.start
      data: {}
      target:
        entity_id: timer.bath_light_door
  mode: single
- id: '1685341713816'
  alias: Кухня дубль удержание
  description: ''
  trigger:
  - platform: device
    domain: mqtt
    device_id: a48c1827e91945626ab06a23851ff1a3
    type: action
    subtype: hold
    discovery_id: 0x54ef441000503053 action_hold
  condition: []
  action:
  - type: toggle
    device_id: cea131d0cc56c10c9c8aec6c27c41830
    entity_id: switch.0x54ef44100050f803
    domain: switch
  mode: single
- id: '1685344253292'
  alias: 'Ванная есть движение: включить свет'
  description: ''
  trigger:
  - type: motion
    platform: device
    device_id: ea74710bfbc16a3895f5a58d03219a53
    entity_id: binary_sensor.vannaia_dvizhenie_occupancy
    domain: binary_sensor
  condition:
  - condition: device
    type: is_off
    device_id: 1caa9e19608f785cb00d0e179a7037b6
    entity_id: light.vannaia_svet
    domain: light
  - condition: not
    conditions:
    - condition: state
      entity_id: timer.bath_light_door
      state: paused
  action:
  - service: timer.start
    data: {}
    target:
      entity_id: timer.bath_light_door
  - type: turn_on
    device_id: 1caa9e19608f785cb00d0e179a7037b6
    entity_id: light.vannaia_svet
    domain: light
  mode: single
- id: '1685344403830'
  alias: 'Ванная есть движение: продление'
  description: ''
  trigger:
  - type: motion
    platform: device
    device_id: ea74710bfbc16a3895f5a58d03219a53
    entity_id: binary_sensor.vannaia_dvizhenie_occupancy
    domain: binary_sensor
  condition:
  - condition: device
    type: is_on
    device_id: 1caa9e19608f785cb00d0e179a7037b6
    entity_id: light.vannaia_svet
    domain: light
  - condition: not
    conditions:
    - condition: state
      entity_id: timer.bath_light_door
      state: paused
  action:
  - service: timer.start
    data: {}
    target:
      entity_id: timer.bath_light_door
  mode: single
- id: '1685344707346'
  alias: Ванная свет таймаут
  description: ''
  trigger:
  - platform: event
    event_type: timer.finished
    event_data:
      entity_id: timer.bath_light_door
  condition:
  - condition: device
    type: is_on
    device_id: 1caa9e19608f785cb00d0e179a7037b6
    entity_id: light.vannaia_svet
    domain: light
  action:
  - type: turn_off
    device_id: 1caa9e19608f785cb00d0e179a7037b6
    entity_id: light.vannaia_svet
    domain: light
  mode: single
- id: '1685346141237'
  alias: 'Ванная свет включен: запуск таймера'
  description: ''
  trigger:
  - platform: device
    type: turned_on
    device_id: 1caa9e19608f785cb00d0e179a7037b6
    entity_id: light.vannaia_svet
    domain: light
  condition: []
  action:
  - service: timer.start
    data: {}
    target:
      entity_id: timer.bath_light_door
  mode: single
- id: '1685346273113'
  alias: 'Ванная свет выключен: стоп таймера'
  description: ''
  trigger:
  - platform: device
    type: turned_off
    device_id: 1caa9e19608f785cb00d0e179a7037b6
    entity_id: light.vannaia_svet
    domain: light
  condition: []
  action:
  - service: timer.cancel
    data: {}
    target:
      entity_id: timer.bath_light_door
  mode: single
- id: '1685453884897'
  alias: Прихожая входная дверь открыта
  description: ''
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.vkhodnaia_dver_contact
    from: 'off'
    to: 'on'
  condition: []
  action:
  - if:
    - condition: state
      entity_id: schedule.hall_enter
      state: 'on'
    then:
    - delay:
        hours: 0
        minutes: 0
        seconds: 0
        milliseconds: 500
    - service: script.1690147971471
      data: {}
    else:
    - type: turn_on
      device_id: 90aa0484d31a94b1d4d4d948dd110d6e
      entity_id: switch.rele_1_prikhozhaia
      domain: switch
  - service: notify.ha_notificator_denis
    data:
      message: "{% from 'common.jinja' import is_seconds_ago_less %} \n{{ iif(is_seconds_ago_less('input_datetime.hall_last_movement_time',
        90)|bool==True,'Выход','Вход') }}"
  mode: single
- id: '1685472103616'
  alias: 'Туалет свет включен: установить яркость'
  description: ''
  trigger:
  - platform: device
    type: turned_on
    device_id: de7a71b8fd0f7085ab6f8df702d7a4f0
    entity_id: light.tualet_svet
    domain: light
  condition: []
  action:
  - choose:
    - conditions:
      - condition: state
        entity_id: schedule.tualet_vannaia_raspisanie_den
        state: 'on'
      sequence:
      - type: turn_on
        device_id: de7a71b8fd0f7085ab6f8df702d7a4f0
        entity_id: light.tualet_svet
        domain: light
        brightness_pct: 70
    - conditions:
      - condition: state
        entity_id: schedule.tualet_vannaia_raspisanie_noch
        state: 'on'
      sequence:
      - type: turn_on
        device_id: de7a71b8fd0f7085ab6f8df702d7a4f0
        entity_id: light.tualet_svet
        domain: light
        brightness_pct: 1
    - conditions:
      - condition: state
        entity_id: schedule.tualet_vannaia_raspisanie_utro_vecher
        state: 'on'
      sequence:
      - type: turn_on
        device_id: de7a71b8fd0f7085ab6f8df702d7a4f0
        entity_id: light.tualet_svet
        domain: light
        brightness_pct: 30
  mode: single
- id: '1685473422404'
  alias: 'Ванная свет включен: установить яркость'
  description: ''
  trigger:
  - platform: device
    type: turned_on
    device_id: 1caa9e19608f785cb00d0e179a7037b6
    entity_id: light.vannaia_svet
    domain: light
  condition: []
  action:
  - choose:
    - conditions:
      - condition: state
        entity_id: schedule.tualet_vannaia_raspisanie_den
        state: 'on'
      sequence:
      - type: turn_on
        device_id: 1caa9e19608f785cb00d0e179a7037b6
        entity_id: light.vannaia_svet
        domain: light
        brightness_pct: 75
    - conditions:
      - condition: state
        entity_id: schedule.tualet_vannaia_raspisanie_noch
        state: 'on'
      sequence:
      - type: turn_on
        device_id: 1caa9e19608f785cb00d0e179a7037b6
        entity_id: light.vannaia_svet
        domain: light
        brightness_pct: 1
    - conditions:
      - condition: state
        entity_id: schedule.tualet_vannaia_raspisanie_utro_vecher
        state: 'on'
      sequence:
      - type: turn_on
        device_id: 1caa9e19608f785cb00d0e179a7037b6
        entity_id: light.vannaia_svet
        domain: light
        brightness_pct: 30
  mode: single
- id: '1686047933521'
  alias: Детская кнопка 2 раза
  description: ''
  trigger:
  - platform: device
    domain: mqtt
    device_id: 0577976c8ca5f6f9511fd21a94449a62
    type: action
    subtype: double
    discovery_id: 0x00158d0009df1a2f action_double
  condition: []
  action:
  - type: toggle
    device_id: 0766f4988b021902a3cbf1c54c91b469
    entity_id: switch.detskaia_2_klavishi_right
    domain: switch
  mode: single
- id: '1686047969241'
  alias: Детская кнопка удержание
  description: ''
  trigger:
  - platform: device
    domain: mqtt
    device_id: 0577976c8ca5f6f9511fd21a94449a62
    type: action
    subtype: hold
    discovery_id: 0x00158d0009df1a2f action_hold
  condition: []
  action:
  - type: toggle
    device_id: 0766f4988b021902a3cbf1c54c91b469
    entity_id: switch.detskaia_2_klavishi_left
    domain: switch
  mode: single
- id: '1686339484617'
  alias: Охрана
  description: ''
  trigger:
  - type: motion
    platform: device
    device_id: 384bc5de06080550d181e3a1f14001c4
    entity_id: binary_sensor.kukhnia_dvizhenie_occupancy
    domain: binary_sensor
  - type: motion
    platform: device
    device_id: ea74710bfbc16a3895f5a58d03219a53
    entity_id: binary_sensor.vannaia_dvizhenie_occupancy
    domain: binary_sensor
  - type: motion
    platform: device
    device_id: 70352209ac0baa1903d206e757e47588
    entity_id: binary_sensor.tualet_dvizhenie_occupancy
    domain: binary_sensor
  - type: opened
    platform: device
    device_id: f33886c6b2db3c0d2389e8df6237d397
    entity_id: binary_sensor.vkhodnaia_dver_contact
    domain: binary_sensor
  - type: opened
    platform: device
    device_id: fe4aea95bdeb8772c679f823a4e54144
    entity_id: binary_sensor.tualet_dver_contact
    domain: binary_sensor
  - type: opened
    platform: device
    device_id: 0b8a16f793e932eaa5160bd857c62c82
    entity_id: binary_sensor.vannaia_dver_contact
    domain: binary_sensor
  - platform: device
    type: turned_on
    device_id: de32a39e975899dd8088d80dac8b0c8e
    entity_id: switch.prikhozhaia_vkhod
    domain: switch
  - platform: device
    type: turned_on
    device_id: 6f7bf8bd4233f103ce913b5e82c7ef0a
    entity_id: switch.prikhozhaia_prokhod
    domain: switch
  - platform: device
    type: changed_states
    device_id: 1caa9e19608f785cb00d0e179a7037b6
    entity_id: light.vannaia_svet
    domain: light
  - platform: device
    type: changed_states
    device_id: de7a71b8fd0f7085ab6f8df702d7a4f0
    entity_id: light.tualet_svet
    domain: light
  - platform: device
    type: turned_on
    device_id: 97e0615b18f94d252b3d76007d46c665
    entity_id: switch.gostinaia_2_klavishi_left
    domain: switch
  - platform: device
    type: turned_on
    device_id: 97e0615b18f94d252b3d76007d46c665
    entity_id: switch.gostinaia_2_klavishi_right
    domain: switch
  - platform: device
    type: turned_on
    device_id: 0766f4988b021902a3cbf1c54c91b469
    entity_id: switch.detskaia_2_klavishi_left
    domain: switch
  - platform: device
    type: turned_on
    device_id: 0766f4988b021902a3cbf1c54c91b469
    entity_id: switch.detskaia_2_klavishi_right
    domain: switch
  - platform: device
    type: turned_on
    device_id: ec3fd6bdfe8c439ad6599a7a82935eaa
    entity_id: switch.kukhnia_2_klavishi_left
    domain: switch
  - platform: device
    type: turned_on
    device_id: ec3fd6bdfe8c439ad6599a7a82935eaa
    entity_id: switch.kukhnia_2_klavishi_right
    domain: switch
  - platform: device
    type: turned_on
    device_id: cea131d0cc56c10c9c8aec6c27c41830
    entity_id: switch.0x54ef44100050f803
    domain: switch
  - type: motion
    platform: device
    device_id: c269c13ef41882b58e9d63e33f96484f
    entity_id: binary_sensor.prikhozhaia_1_dvizhenie_occupancy
    domain: binary_sensor
  - type: motion
    platform: device
    device_id: 6b5e8f3584e2a4972021bfdf0fd651cf
    entity_id: binary_sensor.prikhozhaia_2_dvizhenie_occupancy
    domain: binary_sensor
  - type: motion
    platform: device
    device_id: 50024da6545857fb87b81810a7c6373d
    entity_id: binary_sensor.prikhozhaia_3_dvizhenie_occupancy
    domain: binary_sensor
  - type: motion
    platform: device
    device_id: ed407103a3f18dad945d48213cc8b193
    entity_id: binary_sensor.prikhozhaia_4_dvizhenie_occupancy
    domain: binary_sensor
  - type: motion
    platform: device
    device_id: 4c922d4901098fcb9f23ca07cb327de1
    entity_id: binary_sensor.prikhozhaia_5_dvizhenie_occupancy
    domain: binary_sensor
  - type: motion
    platform: device
    device_id: 8d82e44094c7bbf69f740df9af6531d6
    entity_id: binary_sensor.prikhozhaia_6_dvizhenie_occupancy
    domain: binary_sensor
  condition: []
  action:
  - service: input_number.increment
    data: {}
    target:
      entity_id: input_number.securitycounter
  - service: notify.ha_notificator_denis
    data:
      message: 'Охрана: {{ states(''input_number.securitycounter'')  }}'
  mode: single
- id: '1687350425039'
  alias: Охрана по присутствию
  description: ''
  trigger:
  - platform: device
    device_id: bf4876d1a04fc53fd272621e5f48c5a8
    domain: device_tracker
    entity_id: device_tracker.signalizatsiia_starline_location
    type: enters
    zone: zone.home
    enabled: false
  - platform: device
    device_id: bf4876d1a04fc53fd272621e5f48c5a8
    domain: device_tracker
    entity_id: device_tracker.signalizatsiia_starline_location
    type: leaves
    zone: zone.home
    enabled: false
  - platform: state
    entity_id:
    - device_tracker.pixel_5
  - platform: state
    entity_id:
    - device_tracker.pixel_5
    to: home
    enabled: false
  - platform: state
    entity_id:
    - device_tracker.signalizatsiia_starline_location
    enabled: false
  - platform: state
    entity_id:
    - device_tracker.signalizatsiia_starline_location
    to: home
    enabled: false
  condition: []
  action:
  - choose:
    - conditions:
      - condition: or
        conditions:
        - condition: device
          device_id: f7675381a3676f188798dc19b23d21a7
          domain: device_tracker
          entity_id: 251aefb22791cd7150020e99b9aff5ea
          type: is_home
        - condition: device
          device_id: bf4876d1a04fc53fd272621e5f48c5a8
          domain: device_tracker
          entity_id: device_tracker.signalizatsiia_starline_location
          type: is_home
      - condition: state
        entity_id: automation.okhrana
        state: 'on'
      sequence:
      - service: automation.turn_off
        data:
          stop_actions: true
        target:
          entity_id: automation.okhrana
      - service: script.confirm_security_on
        data: {}
    - conditions:
      - condition: or
        conditions:
        - condition: device
          device_id: f7675381a3676f188798dc19b23d21a7
          domain: device_tracker
          entity_id: 251aefb22791cd7150020e99b9aff5ea
          type: is_not_home
        - condition: device
          device_id: bf4876d1a04fc53fd272621e5f48c5a8
          domain: device_tracker
          entity_id: device_tracker.signalizatsiia_starline_location
          type: is_not_home
      - condition: state
        entity_id: automation.okhrana
        state: 'off'
      sequence:
      - service: automation.turn_on
        data: {}
        target:
          entity_id: automation.okhrana
      - service: script.confirm_security_on
        data: {}
  mode: single
- id: '1687814111309'
  alias: Туалет освещение общий сценарий
  description: ''
  trigger:
  - type: opened
    platform: device
    device_id: fe4aea95bdeb8772c679f823a4e54144
    entity_id: binary_sensor.tualet_dver_contact
    domain: binary_sensor
    enabled: false
  - platform: state
    entity_id:
    - binary_sensor.tualet_dver_contact
    from: 'off'
    to: 'on'
  condition:
  - condition: and
    conditions:
    - condition: state
      entity_id: input_boolean.toilet_was_movement_inside
      state: 'off'
    - condition: state
      entity_id: input_boolean.tualet_dvizhenie_dver_otkryta
      state: 'off'
  action:
  - parallel:
    - service: script.motion_closed
      data: {}
    - service: script.motion_open
      data: {}
  mode: restart
- id: '1688134604383'
  alias: Полив старт по времени
  description: ''
  trigger:
  - platform: time
    at: '10:00:00'
  - platform: time
    at: '22:00:00'
  condition:
  - type: is_not_moist
    condition: device
    device_id: bff9fac3220eb61b3c7b73755cd01cf6
    entity_id: binary_sensor.protechka_1_water_leak
    domain: binary_sensor
  - type: is_not_moist
    condition: device
    device_id: 08dcff36bc1db4c122314cda56a89b47
    entity_id: binary_sensor.protechka_2_water_leak
    domain: binary_sensor
  - type: is_not_moist
    condition: device
    device_id: ae6e1a33d1f75935731f6db336851c02
    entity_id: binary_sensor.protechka_3_water_leak
    domain: binary_sensor
  - type: is_not_moist
    condition: device
    device_id: 259578870e9214dee04d136b4bce512d
    entity_id: binary_sensor.protechka_4_water_leak
    domain: binary_sensor
  action:
  - service: notify.ha_notificator_denis
    data:
      message: Полив через 2 минут
  - delay:
      hours: 0
      minutes: 2
      seconds: 0
      milliseconds: 0
  - service: notify.ha_notificator_denis
    data:
      message: Полив начат
  - service: timer.start
    data: {}
    target:
      entity_id: timer.poliv
  - type: turn_on
    device_id: b3d91aab9ddc6c01a0f36e7d5307ac29
    entity_id: switch.wd_01ade_switch_1
    domain: switch
  - delay:
      hours: 0
      minutes: 3
      seconds: 0
      milliseconds: 0
  - type: turn_off
    device_id: b3d91aab9ddc6c01a0f36e7d5307ac29
    entity_id: switch.wd_01ade_switch_1
    domain: switch
  - service: notify.ha_notificator_denis
    data:
      message: Полив завершен
  mode: single
- id: '1688135472400'
  alias: Полив дополнительное выключение
  description: для подстраховки
  trigger:
  - platform: event
    event_type: timer.finished
    event_data:
      entity_id: timer.poliv
    enabled: false
  - platform: time_pattern
    minutes: /5
  - platform: homeassistant
    event: start
  condition:
  - condition: or
    conditions:
    - condition: device
      type: is_on
      device_id: b3d91aab9ddc6c01a0f36e7d5307ac29
      entity_id: switch.wd_01ade_switch_1
      domain: switch
    - condition: device
      type: is_on
      device_id: b3d91aab9ddc6c01a0f36e7d5307ac29
      entity_id: switch.wd_01ade_switch_2
      domain: switch
  action:
  - type: turn_off
    device_id: b3d91aab9ddc6c01a0f36e7d5307ac29
    entity_id: switch.wd_01ade_switch_1
    domain: switch
  - type: turn_off
    device_id: b3d91aab9ddc6c01a0f36e7d5307ac29
    entity_id: switch.wd_01ade_switch_2
    domain: switch
  - service: notify.ha_notificator_denis
    data:
      message: Полив выключен подстраховкой!
  mode: single
- id: '1689338028789'
  alias: Туалет дверь длительность открытия
  description: ''
  trigger:
  - type: opened
    platform: device
    device_id: fe4aea95bdeb8772c679f823a4e54144
    entity_id: binary_sensor.tualet_dver_contact
    domain: binary_sensor
    for:
      hours: 0
      minutes: 0
      seconds: 0
    enabled: true
  condition:
  - condition: template
    value_template: '{{ is_state(''binary_sensor.tualet_dver_contact'', ''on'') and
      (as_timestamp(now()) - as_timestamp(states(''sensor.tualet_dver_last_seen''))
      < 5) }}'
    enabled: false
  action:
  - wait_for_trigger:
    - type: not_opened
      platform: device
      device_id: fe4aea95bdeb8772c679f823a4e54144
      entity_id: binary_sensor.tualet_dver_contact
      domain: binary_sensor
      for:
        hours: 0
        minutes: 0
        seconds: 0
    continue_on_timeout: false
    timeout:
      hours: 0
      minutes: 0
      seconds: 5
      milliseconds: 0
  - service: logbook.log
    data:
      name: open
      message: STOP BY FAST CLOSE (before)
      entity_id: automation.left
    enabled: false
  - service: script.turn_off
    data: {}
    target:
      entity_id: script.motion_open
  - service: logbook.log
    data:
      name: open
      message: STOP BY FAST CLOSE (after)
      entity_id: automation.left
    enabled: false
  mode: single
- id: '1690141694594'
  alias: Прихожая вход выключатель
  description: ''
  trigger:
  - platform: device
    domain: mqtt
    device_id: 712ffd3fb57445407a8a9c734b94c063
    type: action
    subtype: single
    discovery_id: 0x54ef4410005cf4cc action_single
  - platform: device
    domain: mqtt
    device_id: c87c44ef24934fb7df148b21d67ef0c4
    type: action
    subtype: single
    discovery_id: 0x54ef4410005ce71c action_single
  condition: []
  action:
  - if:
    - condition: and
      conditions:
      - condition: state
        entity_id: switch.gruppa_rele_vkhod
        state: 'off'
      - condition: state
        entity_id: switch.gruppa_rele_prokhod
        state: 'off'
    then:
    - service: script.1692113141376
      data: {}
    else:
    - service: script.1692113251887
      data: {}
  mode: single
- id: '1690147598337'
  alias: Прихожая проход выключатель
  description: ''
  trigger:
  - platform: device
    domain: mqtt
    device_id: c87c44ef24934fb7df148b21d67ef0c4
    type: action
    subtype: single
    discovery_id: 0x54ef4410005ce71c action_single
  condition: []
  action:
  - if:
    - condition: state
      entity_id: switch.gruppa_rele_prokhod
      state: 'off'
    then:
    - service: script.1690148303882
      data: {}
    else:
    - if:
      - condition: state
        entity_id: switch.gruppa_rele_prokhod
        state: 'on'
      then:
      - service: script.1690148420628
        data: {}
  mode: single
- id: '1690148911050'
  alias: Прихожая есть Движение 1
  description: ''
  use_blueprint:
    path: homeassistant/motion_light_fix.yaml
    input:
      light_target:
        entity_id: switch.rele_1_prikhozhaia
      motion_entity: binary_sensor.prikhozhaia_1_dvizhenie_occupancy
      no_motion_wait: 240
- id: '1690148983287'
  alias: Прихожая есть движение 2
  description: ''
  use_blueprint:
    path: homeassistant/motion_light_fix.yaml
    input:
      motion_entity: binary_sensor.prikhozhaia_2_dvizhenie_occupancy
      no_motion_wait: 240
      light_target:
        entity_id: switch.rele_2_prikhozhaia
- id: '1690149013021'
  alias: Прихожая есть движение 3
  description: ''
  use_blueprint:
    path: homeassistant/motion_light_fix.yaml
    input:
      motion_entity: binary_sensor.prikhozhaia_3_dvizhenie_occupancy
      no_motion_wait: 240
      light_target:
        entity_id: switch.rele_3_prikhozhaia
- id: '1690149033855'
  alias: Прихожая есть движение 4
  description: ''
  use_blueprint:
    path: homeassistant/motion_light_fix.yaml
    input:
      motion_entity: binary_sensor.prikhozhaia_4_dvizhenie_occupancy
      no_motion_wait: 240
      light_target:
        entity_id: switch.rele_4_prikhozhaia
- id: '1690149053907'
  alias: Прихожая есть движение 5
  description: ''
  use_blueprint:
    path: homeassistant/motion_light_fix.yaml
    input:
      motion_entity: binary_sensor.prikhozhaia_5_dvizhenie_occupancy
      no_motion_wait: 240
      light_target:
        entity_id: switch.rele_5_prikhozhaia
- id: '1690149086863'
  alias: Прихожая есть движение 6
  description: ''
  use_blueprint:
    path: homeassistant/motion_light_fix.yaml
    input:
      motion_entity: binary_sensor.prikhozhaia_6_dvizhenie_occupancy
      no_motion_wait: 240
      light_target:
        entity_id: switch.rele_6_prikhozhaia
- id: '1690150355615'
  alias: Обнаружена любая протечка
  description: ''
  trigger:
  - type: moist
    platform: device
    device_id: bff9fac3220eb61b3c7b73755cd01cf6
    entity_id: binary_sensor.protechka_1_water_leak
    domain: binary_sensor
  - type: moist
    platform: device
    device_id: 08dcff36bc1db4c122314cda56a89b47
    entity_id: binary_sensor.protechka_2_water_leak
    domain: binary_sensor
  - type: moist
    platform: device
    device_id: ae6e1a33d1f75935731f6db336851c02
    entity_id: binary_sensor.protechka_3_water_leak
    domain: binary_sensor
  - type: moist
    platform: device
    device_id: 259578870e9214dee04d136b4bce512d
    entity_id: binary_sensor.protechka_4_water_leak
    domain: binary_sensor
  condition: []
  action:
  - service: notify.denis_maria
    data:
      title: Протечка!
      message: "Ванная: {{ iif(states('binary_sensor.protechka_1_water_leak')=='on','Есть','Сухо')
        }}\nУмывальник: {{ iif(states('binary_sensor.protechka_2_water_leak')=='on','Есть','Сухо')
        }}  \nТуалет: {{    iif(states('binary_sensor.protechka_3_water_leak')=='on','Есть','Сухо')
        }} \nКухня: {{ iif(states('binary_sensor.protechka_4_water_leak')=='on','Есть','Сухо')
        }}"
  - service: automation.turn_off
    data:
      stop_actions: true
    target:
      entity_id: automation.poliv
    enabled: false
  - type: turn_off
    device_id: b3d91aab9ddc6c01a0f36e7d5307ac29
    entity_id: switch.wd_01ade_switch_1
    domain: switch
    enabled: false
  - type: turn_off
    device_id: b3d91aab9ddc6c01a0f36e7d5307ac29
    entity_id: switch.wd_01ade_switch_2
    domain: switch
    enabled: false
  - parallel:
    - if:
      - condition: template
        value_template: '{{ True }}'
      then:
      - wait_template: "{{ \n(states('binary_sensor.protechka_1_water_leak')=='off')
          and\n(states('binary_sensor.protechka_2_water_leak')=='off') and\n(states('binary_sensor.protechka_3_water_leak')=='off')
          and \n(states('binary_sensor.protechka_4_water_leak')=='off')\n}}"
        continue_on_timeout: true
      - type: turn_off
        device_id: 317e715efed4668af796f4b9bfd876d6
        entity_id: 72087670833b39b1022f844b00664f32
        domain: switch
      - service: notify.denis_maria
        data:
          title: Протечка устаранена
          message: "Ванная: {{ iif(states('binary_sensor.protechka_1_water_leak')=='on','Есть','Сухо')
            }}\nУмывальник: {{ iif(states('binary_sensor.protechka_2_water_leak')=='on','Есть','Сухо')
            }}  \nТуалет: {{    iif(states('binary_sensor.protechka_3_water_leak')=='on','Есть','Сухо')
            }} \nКухня: {{ iif(states('binary_sensor.protechka_4_water_leak')=='on','Есть','Сухо')
            }}"
      - stop: fixed
      alias: wait fix
    - if:
      - condition: template
        value_template: '{{ True }}'
      then:
      - repeat:
          count: 10
          sequence:
          - if:
            - condition: template
              value_template: "{{ \n(states('binary_sensor.protechka_1_water_leak')=='off')
                and\n(states('binary_sensor.protechka_2_water_leak')=='off') and\n(states('binary_sensor.protechka_3_water_leak')=='off')
                and\n(states('binary_sensor.protechka_4_water_leak')=='off')\n}}"
            then:
            - type: turn_off
              device_id: 317e715efed4668af796f4b9bfd876d6
              entity_id: 72087670833b39b1022f844b00664f32
              domain: switch
            - stop: stop on cycle
            alias: check fixed
          - device_id: 317e715efed4668af796f4b9bfd876d6
            domain: select
            entity_id: 7d1d93d326cabe7c092fe21ef9ab5102
            type: select_option
            option: '7'
          - device_id: 317e715efed4668af796f4b9bfd876d6
            domain: number
            entity_id: 77420ed78e95dab971713e53984d49c3
            type: set_value
            value: 2
          - type: turn_on
            device_id: 317e715efed4668af796f4b9bfd876d6
            entity_id: 72087670833b39b1022f844b00664f32
            domain: switch
          - delay:
              hours: 0
              minutes: 1
              seconds: 0
              milliseconds: 0
      - service: notify.denis_maria
        data:
          title: Протечка таймаут
          message: "Ванная: {{ iif(states('binary_sensor.protechka_1_water_leak')=='on','Есть','Сухо')
            }}\nУмывальник: {{ iif(states('binary_sensor.protechka_2_water_leak')=='on','Есть','Сухо')
            }}  \nТуалет: {{    iif(states('binary_sensor.protechka_3_water_leak')=='on','Есть','Сухо')
            }} \nКухня: {{ iif(states('binary_sensor.protechka_4_water_leak')=='on','Есть','Сухо')
            }}"
      alias: alert cycle
  mode: restart
- id: '1691485100653'
  alias: 'Ванная есть движение при закрытой двери: пауза таймера'
  description: ''
  trigger:
  - type: motion
    platform: device
    device_id: ea74710bfbc16a3895f5a58d03219a53
    entity_id: 97739bf8e91fad811f21fbe0907a9587
    domain: binary_sensor
  condition:
  - type: is_not_open
    condition: device
    device_id: 0b8a16f793e932eaa5160bd857c62c82
    entity_id: 906ce8cd2c80c3535a634c60a0f608da
    domain: binary_sensor
  action:
  - service: timer.pause
    data: {}
    target:
      entity_id: timer.bath_light_door
  mode: single
- id: '1691618362176'
  alias: Детская кнопка 1 раз
  description: ''
  trigger:
  - platform: device
    domain: mqtt
    device_id: 0577976c8ca5f6f9511fd21a94449a62
    type: action
    subtype: single
    discovery_id: 0x00158d0009df1a2f action_single
  condition: []
  action:
  - type: toggle
    device_id: 4d927d700244854a5d3066302473ca09
    entity_id: 17034e9f9c44fc804c5eeea471578fe4
    domain: switch
    enabled: false
  - type: toggle
    device_id: e102d81f8a31a1ee1f4d1ce04f953259
    entity_id: edd69b3928034e9612a768378201b112
    domain: switch
    enabled: false
  - choose:
    - conditions:
      - condition: or
        conditions:
        - condition: device
          type: is_on
          device_id: 4d927d700244854a5d3066302473ca09
          entity_id: 17034e9f9c44fc804c5eeea471578fe4
          domain: switch
        - condition: device
          type: is_on
          device_id: e102d81f8a31a1ee1f4d1ce04f953259
          entity_id: edd69b3928034e9612a768378201b112
          domain: switch
      sequence:
      - type: turn_off
        device_id: 4d927d700244854a5d3066302473ca09
        entity_id: 17034e9f9c44fc804c5eeea471578fe4
        domain: switch
      - type: turn_off
        device_id: e102d81f8a31a1ee1f4d1ce04f953259
        entity_id: edd69b3928034e9612a768378201b112
        domain: switch
    - conditions:
      - condition: or
        conditions:
        - condition: device
          type: is_off
          device_id: 4d927d700244854a5d3066302473ca09
          entity_id: 17034e9f9c44fc804c5eeea471578fe4
          domain: switch
        - condition: device
          type: is_off
          device_id: e102d81f8a31a1ee1f4d1ce04f953259
          entity_id: edd69b3928034e9612a768378201b112
          domain: switch
      sequence:
      - type: turn_on
        device_id: 4d927d700244854a5d3066302473ca09
        entity_id: 17034e9f9c44fc804c5eeea471578fe4
        domain: switch
      - type: turn_on
        device_id: e102d81f8a31a1ee1f4d1ce04f953259
        entity_id: edd69b3928034e9612a768378201b112
        domain: switch
  mode: restart
- id: '1693381125792'
  alias: Кухня подсветка скоро выключение
  description: ''
  trigger:
  - platform: template
    value_template: '{% from ''common.jinja'' import is_seconds_remains_prop_less
      %}

      {{is_seconds_remains_prop_less(''timer.kitchen_backlight_timer'',''finishes_at'',60)|bool}}'
  condition:
  - condition: time
    after: 07:00:00
    before: 00:00:00
  action:
  - device_id: 317e715efed4668af796f4b9bfd876d6
    domain: select
    entity_id: 7d1d93d326cabe7c092fe21ef9ab5102
    type: select_option
    option: '15'
    enabled: true
  - device_id: 317e715efed4668af796f4b9bfd876d6
    domain: number
    entity_id: 77420ed78e95dab971713e53984d49c3
    type: set_value
    value: 1
    enabled: true
  - delay:
      hours: 0
      minutes: 0
      seconds: 0
      milliseconds: 500
  - type: turn_on
    device_id: 317e715efed4668af796f4b9bfd876d6
    entity_id: 72087670833b39b1022f844b00664f32
    domain: switch
    enabled: true
  - wait_template: '{{ is_state(''binary_sensor.kukhnia_dvizhenie_occupancy'', ''on'')
      }}'
    continue_on_timeout: false
    timeout: '60'
  - device_id: 317e715efed4668af796f4b9bfd876d6
    domain: select
    entity_id: 7d1d93d326cabe7c092fe21ef9ab5102
    type: select_option
    option: '16'
    enabled: true
  - device_id: 317e715efed4668af796f4b9bfd876d6
    domain: number
    entity_id: 77420ed78e95dab971713e53984d49c3
    type: set_value
    value: 1
    enabled: true
  - delay:
      hours: 0
      minutes: 0
      seconds: 0
      milliseconds: 500
  - type: turn_on
    device_id: 317e715efed4668af796f4b9bfd876d6
    entity_id: 72087670833b39b1022f844b00664f32
    domain: switch
    enabled: true
  mode: single
- id: '1693984575486'
  alias: Прихожая проход режим дня
  description: ''
  trigger:
  - platform: state
    entity_id:
    - schedule.hall_pass
    from: 'off'
    to: 'on'
  - platform: state
    entity_id:
    - schedule.hall_pass
    from: 'on'
    to: 'off'
  condition: []
  action:
  - choose:
    - conditions:
      - condition: state
        entity_id: schedule.hall_pass
        state: 'on'
      sequence:
      - service: automation.turn_on
        data: {}
        target:
          entity_id: automation.est_dvizhenie_1
      - service: automation.turn_on
        data: {}
        target:
          entity_id: automation.est_dvizhenie_2
      - service: automation.turn_on
        data: {}
        target:
          entity_id: automation.est_dvizhenie_3
      - service: automation.turn_on
        data: {}
        target:
          entity_id: automation.est_dvizhenie_4
      - service: automation.turn_on
        data: {}
        target:
          entity_id: automation.est_dvizhenie_5
      - service: automation.turn_on
        data: {}
        target:
          entity_id: automation.est_dvizhenie_6
      - service: automation.turn_off
        data:
          stop_actions: true
        target:
          entity_id: automation.prikhozhaia_dvizhenie_nochnoi_rezhim
    - conditions:
      - condition: state
        entity_id: schedule.hall_pass
        state: 'off'
      sequence:
      - service: automation.turn_off
        data:
          stop_actions: true
        target:
          entity_id: automation.est_dvizhenie_1
      - service: automation.turn_off
        data:
          stop_actions: true
        target:
          entity_id: automation.est_dvizhenie_2
      - service: automation.turn_off
        data:
          stop_actions: true
        target:
          entity_id: automation.est_dvizhenie_3
      - service: automation.turn_off
        data:
          stop_actions: true
        target:
          entity_id: automation.est_dvizhenie_4
      - service: automation.turn_off
        data:
          stop_actions: true
        target:
          entity_id: automation.est_dvizhenie_5
      - service: automation.turn_off
        data:
          stop_actions: true
        target:
          entity_id: automation.est_dvizhenie_6
      - service: automation.turn_on
        data: {}
        target:
          entity_id: automation.prikhozhaia_dvizhenie_nochnoi_rezhim
      - if:
        - condition: state
          entity_id: switch.gruppa_rele_prokhod
          state: 'on'
        then:
        - service: script.1690148420628
          data: {}
        - service: automation.trigger
          data:
            skip_condition: true
          target:
            entity_id: automation.prikhozhaia_dvizhenie_nochnoi_rezhim
        - service: notify.ha_notificator_denis
          data:
            message: 'переход прихожая ночной режим, было включено: проход'
      - if:
        - condition: state
          entity_id: switch.gruppa_rele_vkhod
          state: 'on'
        then:
        - service: script.1690148096831
          data: {}
        - service: automation.trigger
          data:
            skip_condition: true
          target:
            entity_id: automation.prikhozhaia_dvizhenie_nochnoi_rezhim
        - service: notify.ha_notificator_denis
          data:
            message: 'переход прихожая ночной режим, было включено: вход'
  mode: single
- id: '1693992348607'
  alias: Прихожая движение ночной режим
  description: ''
  trigger:
  - type: motion
    platform: device
    device_id: c269c13ef41882b58e9d63e33f96484f
    entity_id: bbb35f66179e64fbf69605bbcce7e3d7
    domain: binary_sensor
  - type: motion
    platform: device
    device_id: 6b5e8f3584e2a4972021bfdf0fd651cf
    entity_id: 37cec3caaa5e7f86709bd96acedaefef
    domain: binary_sensor
  - type: motion
    platform: device
    device_id: 50024da6545857fb87b81810a7c6373d
    entity_id: fc83dc8e71f5755f1b1d6e15254fbd64
    domain: binary_sensor
  - type: motion
    platform: device
    device_id: ed407103a3f18dad945d48213cc8b193
    entity_id: 1a829401d7c55efdb758f7fa3092e536
    domain: binary_sensor
  - type: motion
    platform: device
    device_id: 4c922d4901098fcb9f23ca07cb327de1
    entity_id: 093ec68fa8869e67bb8988c787b35c98
    domain: binary_sensor
  - type: motion
    platform: device
    device_id: 8d82e44094c7bbf69f740df9af6531d6
    entity_id: 6e1b536c7685fe49e8c685f24ab41572
    domain: binary_sensor
  condition: []
  action:
  - type: turn_on
    device_id: 90aa0484d31a94b1d4d4d948dd110d6e
    entity_id: f83df8a2c0bd6bc986ea00f41cf9081c
    domain: switch
  - service: timer.start
    data: {}
    target:
      entity_id: timer.timer_hall_pass
  mode: single
- id: '1693994884964'
  alias: Прихожая ночной свет таймаут
  description: ''
  trigger:
  - platform: event
    event_type: timer.finished
    event_data:
      entity_id: timer.timer_hall_pass
  condition:
  - condition: device
    type: is_on
    device_id: 90aa0484d31a94b1d4d4d948dd110d6e
    entity_id: f83df8a2c0bd6bc986ea00f41cf9081c
    domain: switch
  action:
  - type: turn_off
    device_id: 90aa0484d31a94b1d4d4d948dd110d6e
    entity_id: f83df8a2c0bd6bc986ea00f41cf9081c
    domain: switch
  mode: single
- id: '1694769742536'
  alias: Гостиная колонки
  description: ''
  trigger:
  - platform: device
    domain: mqtt
    device_id: cb5a1302a8884dae4b0c8fd478834990
    type: action
    subtype: single_both
    discovery_id: 0x54ef4410004ff618 action_single_both
  condition: []
  action:
  - type: toggle
    device_id: 41ac86c278e4a8c9011afa5336d95a9c
    entity_id: cd47862de026a5b521088c7a814fa740
    domain: switch
  mode: single
- id: '1695193089078'
  alias: Туалет движение - свет
  description: ''
  use_blueprint:
    path: homeassistant/motion_light.yaml
    input:
      light_target:
        entity_id: light.tualet_svet
      motion_entity: binary_sensor.tualet_dvizhenie_occupancy
      no_motion_wait: 600
- id: '1695909085559'
  alias: Движение прихожая - обновить дату
  description: ''
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.gruppa_dvizhenie_prikhozhaia
    to: 'on'
  condition: []
  action:
  - service: input_datetime.set_datetime
    data:
      datetime: '{{ now() }}'
    target:
      entity_id: input_datetime.hall_last_movement_time
  mode: single
- id: '1695918965225'
  alias: Прихожая входная дверь закрыта
  description: ''
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.vkhodnaia_dver_contact
    from: 'on'
    to: 'off'
  condition: []
  action:
  - service: automation.trigger
    data:
      skip_condition: true
    target:
      entity_id: automation.dvizhenie_prikhozhaia_obnovit_datu
  - delay:
      hours: 0
      minutes: 0
      seconds: 45
      milliseconds: 0
  - if:
    - condition: template
      value_template: '{% from ''common.jinja'' import seconds_ago_passed %}

        {{ seconds_ago_passed(''input_datetime.hall_last_movement_time'')|int > 43
        }}'
    then:
    - service: notify.ha_notificator_denis
      data:
        message: 'Вход: закрыто и нет движения'
      enabled: true
    - service: script.1692113251887
      data: {}
  mode: single
- id: '1696446359201'
  alias: test timer
  description: ''
  use_blueprint:
    path: test-timer.yaml
    input:
      timer_no_motion: timer.test_timer_6
      motion_entity: binary_sensor.prikhozhaia_6_dvizhenie_occupancy
- id: '1696848947314'
  alias: Туалет свет выключен - обновить дату
  description: ''
  trigger:
  - platform: device
    type: turned_off
    device_id: de7a71b8fd0f7085ab6f8df702d7a4f0
    entity_id: b6b9026dbd0bafddb73e085c7a1cbe56
    domain: light
  condition: []
  action:
  - service: input_datetime.set_datetime
    data:
      datetime: '{{ now() }}'
    target:
      entity_id: input_datetime.toilet_last_off_time
  mode: single
- id: '1696849385613'
  alias: Туалет свет включен - выключить
  description: ''
  trigger:
  - platform: device
    type: turned_on
    device_id: de7a71b8fd0f7085ab6f8df702d7a4f0
    entity_id: light.tualet_svet
    domain: light
  condition:
  - condition: template
    value_template: "{{\n((now()|as_timestamp|round)\n- \n(states('input_datetime.toilet_last_off_time')|as_datetime|as_local|as_timestamp|round))
      < 5\n}}\n"
  action:
  - service: input_boolean.turn_on
    data: {}
    target:
      entity_id: input_boolean.toilet_fan_no_start
    enabled: true
  - service: timer.cancel
    data: {}
    target:
      entity_id: timer.taimer_tualet_svet
    enabled: true
  - delay:
      hours: 0
      minutes: 0
      seconds: 0
      milliseconds: 500
  - type: turn_off
    device_id: de7a71b8fd0f7085ab6f8df702d7a4f0
    entity_id: b6b9026dbd0bafddb73e085c7a1cbe56
    domain: light
  mode: single
- id: '1697744362944'
  alias: Light for motion with timers 1
  description: ''
  use_blueprint:
    path: motion_light_timers.yaml
    input:
      off_by_timeout: input_boolean.test_bool_6
      motion_trigger: binary_sensor.tualet_dvizhenie_occupancy
      light_switch: switch.0x70ac08fffec0fd2a
      time_motion_delay:
        hours: 0
        minutes: 3
        seconds: 0
      timer_no_motion: timer.test_timer_6
      timer_manual_off: timer.test_timer_7
      timer_motion: timer.test_timer_6
      timer_motion_duration: 39
      timer_manual_off_duration: 20
- id: '1697804050498'
  alias: Кнопка звонок дверь
  description: ''
  trigger:
  - platform: device
    domain: mqtt
    device_id: 07221d4d0466ecae4f87d9f1feb4036e
    type: action
    subtype: single
    discovery_id: 0xa4c138dc99733620 action_single
  condition: []
  action:
  - device_id: 317e715efed4668af796f4b9bfd876d6
    domain: select
    entity_id: ffbec99621bfd5aa75ff2c4427409b70
    type: select_option
    option: high
  - device_id: 317e715efed4668af796f4b9bfd876d6
    domain: select
    entity_id: 7d1d93d326cabe7c092fe21ef9ab5102
    type: select_option
    option: '4'
  - device_id: 317e715efed4668af796f4b9bfd876d6
    domain: number
    entity_id: 77420ed78e95dab971713e53984d49c3
    type: set_value
    value: 10
  - delay:
      hours: 0
      minutes: 0
      seconds: 1
      milliseconds: 0
  - type: turn_on
    device_id: 317e715efed4668af796f4b9bfd876d6
    entity_id: 72087670833b39b1022f844b00664f32
    domain: switch
  - service: notify.denis_maria
    data:
      message: Звонок в двери
  mode: single
- id: '1698397544545'
  alias: Изменение расхода воды
  description: ''
  trigger:
  - type: water
    platform: device
    device_id: 7eb73851fcbda20371e5e247552137cc
    entity_id: bcca336f84cabe9f4c88a6f5f7babff0
    domain: sensor
    above: 0.001
    enabled: false
  - platform: state
    entity_id:
    - sensor.water_counter_ch1
    attribute: Cold Water Impulses
    enabled: false
  - platform: state
    entity_id:
    - sensor.water_counter_ch1
    attribute: Cold Water Impulses
  condition: []
  action:
  - service: input_number.set_value
    target:
      entity_id: input_number.water_cold_diff
    data:
      value: '{{ states(''sensor.water_counter_ch1'')|float -states(''input_number.water_cold_last_value'')|float  }}'
  - service: input_number.set_value
    target:
      entity_id: input_number.water_cold_last_value
    data:
      value: '{{ states(''sensor.water_counter_ch1'')|float }}'
  - if:
    - condition: template
      value_template: '{{ states(''input_number.water_cold_diff'') | round(2) > 0.02  }}'
    then:
    - service: notify.ha_notificator_denis
      data:
        message: Расход хол. воды {{ states('input_number.water_cold_diff') | round(2)
          }}
  mode: single
- id: '1699305931010'
  alias: Пылесос убрался
  description: ''
  trigger:
  - platform: device
    device_id: 9ef32c5237c3fc7183363c7b574a2f21
    domain: vacuum
    entity_id: d13cb932142f2ddf48c8cd05979166d7
    type: docked
  condition: []
  action:
  - type: turn_off
    device_id: ec3fd6bdfe8c439ad6599a7a82935eaa
    entity_id: fc5a2f80a06dce76338654c59696f92a
    domain: switch
  - type: turn_off
    device_id: ec3fd6bdfe8c439ad6599a7a82935eaa
    entity_id: e0d0d7254fb735aac44a1bcf95272621
    domain: switch
  - service: notify.ha_notificator_denis
    data:
      message: 'Пылесос убрался '
  mode: single
- id: '1699449368126'
  alias: 'Машина: темперетура в салоне ниже 23 С'
  description: ''
  trigger:
  - platform: state
    entity_id:
    - sensor.signalizatsiia_starline_interior_temperature
  condition:
  - condition: template
    value_template: '{{ states(''sensor.signalizatsiia_starline_interior_temperature'')
      | int < 23 }}'
  action:
  - service: notify.ha_notificator_denis
    data:
      message: в машине ниже 23 С
  mode: single
- id: '1699613882128'
  alias: Кнопка звонок лифт
  description: ''
  trigger:
  - platform: device
    domain: mqtt
    device_id: 216703347296609e5efac6be6df5a7b0
    type: action
    subtype: single
    discovery_id: 0x00158d0009ee2ea9 action_single
  condition: []
  action:
  - device_id: 317e715efed4668af796f4b9bfd876d6
    domain: select
    entity_id: ffbec99621bfd5aa75ff2c4427409b70
    type: select_option
    option: high
  - device_id: 317e715efed4668af796f4b9bfd876d6
    domain: select
    entity_id: 7d1d93d326cabe7c092fe21ef9ab5102
    type: select_option
    option: '1'
  - device_id: 317e715efed4668af796f4b9bfd876d6
    domain: number
    entity_id: 77420ed78e95dab971713e53984d49c3
    type: set_value
    value: 10
  - delay:
      hours: 0
      minutes: 0
      seconds: 1
      milliseconds: 0
  - type: turn_on
    device_id: 317e715efed4668af796f4b9bfd876d6
    entity_id: 72087670833b39b1022f844b00664f32
    domain: switch
  - service: notify.denis_maria
    data:
      message: 'Звонок в двери: лифт'
  mode: single
- id: '1699894515013'
  alias: 'Машина пробег изменился '
  description: ''
  trigger:
  - type: distance
    platform: device
    device_id: bf4876d1a04fc53fd272621e5f48c5a8
    entity_id: 6179de4b199fd5baa47a308c7c29d377
    domain: sensor
    above: 1
    enabled: false
  - platform: state
    entity_id:
    - sensor.signalizatsiia_starline_mileage
  condition:
  - condition: or
    conditions:
    - condition: state
      entity_id: sensor.signalizatsiia_starline_mileage
      state: '44404'
    - condition: state
      entity_id: sensor.signalizatsiia_starline_mileage
      state: '44410'
    - condition: state
      entity_id: sensor.signalizatsiia_starline_mileage
      state: '44404'
    enabled: false
  action:
  - service: notify.ha_notificator_denis
    data:
      message: Машина пробег 44444
  mode: single
- id: '1700120177522'
  alias: Уведомление о прогнозе погоды
  description: ''
  trigger:
  - platform: time
    at: 09:30:00
  condition: []
  action:
  - service: notify.denis_maria
    data:
      title: Прогноз погоды
      message: "Сегодня: {{ states('sensor.yandex_weather_condition_yandex') }} \nСейчас
        на улице: {{ states('sensor.temperatura_vneshniaia_temperature') }}°C | {{state_attr('weather.yandex_weather','wind_speed')/3.6}}
        м/с | {{states('sensor.yandex_weather_humidity')}}% | {{states('sensor.yandex_weather_pressure_mmhg')}}
        mmHg \nОщущается: {{state_attr('weather.yandex_weather','feels_like')}} °C\nЗавтра
        {{ (state_attr('weather.yandex_weather','forecast')[0].datetime | as_datetime).strftime('%d/%m')
        \ }}: {{state_attr('weather.yandex_weather','forecast')[0].condition }} |
        {{state_attr('weather.yandex_weather','forecast')[0].temperature}}°C  | {{
        (state_attr('weather.yandex_weather','forecast')[0].wind_speed/3.6)|round}}
        м/с | {{ (state_attr('weather.yandex_weather','forecast')[0].pressure/1.333)|round
        \ }} mmHg \nПослезавтра {{ (state_attr('weather.yandex_weather','forecast')[1].datetime
        | as_datetime).strftime('%d/%m')  }}: {{state_attr('weather.yandex_weather','forecast')[1].condition
        }} | {{state_attr('weather.yandex_weather','forecast')[1].temperature}}°C
        \ | {{ (state_attr('weather.yandex_weather','forecast')[1].wind_speed/3.6)|round}}
        м/с | {{ (state_attr('weather.yandex_weather','forecast')[1].pressure/1.333)|round
        \ }} mmHg"
  mode: single
- id: '1701454612967'
  alias: Холодильник открыт верх
  description: ''
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.kholodilnik_dvertsa_verkhniaia_contact
    from: 'off'
    to: 'on'
  condition: []
  action:
  - service: timer.start
    data: {}
    target:
      entity_id: timer.taimer_kholodilnik_verkh
  mode: single
- id: '1701454781496'
  alias: Холодильник закрыт верх
  description: ''
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.kholodilnik_dvertsa_verkhniaia_contact
    from: 'on'
    to: 'off'
  condition: []
  action:
  - service: timer.cancel
    data: {}
    target:
      entity_id: timer.taimer_kholodilnik_verkh
  mode: single
- id: '1701455150883'
  alias: Холодильник верх таймаут
  description: ''
  trigger:
  - platform: event
    event_type: timer.finished
    event_data:
      entity_id: timer.taimer_kholodilnik_verkh
  condition: []
  action:
  - service: notify.denis_maria
    data:
      message: Холодильник верх не закрыт!
  mode: single
- id: '1701679503640'
  alias: Холодильник открыт низ
  description: ''
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.kholodilnik_dvertsa_nizhniaia_contact
    from: 'off'
    to: 'on'
  condition: []
  action:
  - service: timer.start
    data: {}
    target:
      entity_id: timer.taimer_kholodilnik_niz
  mode: single
- id: '1701679545992'
  alias: Холодильник закрыт низ
  description: ''
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.kholodilnik_dvertsa_nizhniaia_contact
    from: 'on'
    to: 'off'
  condition: []
  action:
  - service: timer.cancel
    data: {}
    target:
      entity_id: timer.taimer_kholodilnik_niz
  mode: single
- id: '1701679586544'
  alias: Холодильник низ таймаут
  description: ''
  trigger:
  - platform: event
    event_type: timer.finished
    event_data:
      entity_id: timer.taimer_kholodilnik_niz
  condition: []
  action:
  - service: notify.denis_maria
    data:
      message: Холодильник низ не закрыт!
  mode: single
